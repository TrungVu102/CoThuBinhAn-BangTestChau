import React, { useState, useEffect } from 'react';
import { Clipboard, Save, RotateCcw, CheckCircle, FileSpreadsheet, X, FileText, Image as ImageIcon } from 'lucide-react';

const PelvicTestApp = () => {
  // --- LOAD TH∆Ø VI·ªÜN ---
  useEffect(() => {
    const script1 = document.createElement('script');
    script1.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
    script1.async = true;
    document.body.appendChild(script1);

    return () => {
      if (document.body.contains(script1)) document.body.removeChild(script1);
    };
  }, []);

  // --- D·ªÆ LI·ªÜU ---
  const initialData = {
    studentName: '',
    testDate: new Date().toISOString().split('T')[0],
    pelvis: {
      left: 'Ch∆∞a x√°c ƒë·ªãnh',
      right: 'Ch∆∞a x√°c ƒë·ªãnh',
      tilt: 'Ch∆∞a x√°c ƒë·ªãnh',
      rotation: 'Ch∆∞a x√°c ƒë·ªãnh'
    },
    muscles: {
      psoas: { id: 1, name: 'C∆° th·∫Øt l∆∞ng ch·∫≠u - h√°ng, b·∫πn', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      gluteMax: { id: 2, name: 'C∆° m√¥ng l·ªõn - ph·∫ßn m√¥ng to nh·∫•t', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      rectusFem: { id: 3, name: 'C∆° th·∫≥ng ƒë√πi - ƒë√πi tr∆∞·ªõc', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      hamstring: { id: 4, name: 'C∆° g√¢n khoeo - ƒë√πi sau', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      ql: { id: 5, name: 'C∆° vu√¥ng th·∫Øt l∆∞ng - c∆° eo l∆∞ng', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      gluteMed: { id: 6, name: 'C∆° m√¥ng nh·ª° - h√µm h√¥ng', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      adductor: { id: 7, name: 'C∆° kh√©p ƒë√πi - ƒë√πi trong', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
      tfl: { id: 8, name: 'C∆° cƒÉng m·∫°c ƒë√πi - m·∫∑t ngo√†i tr√™n ƒë√πi', left: 'Ch∆∞a x√°c ƒë·ªãnh', right: 'Ch∆∞a x√°c ƒë·ªãnh' },
    },
    note: ''
  };

  const [formData, setFormData] = useState(initialData);
  const [showReport, setShowReport] = useState(false);
  const [isExporting, setIsExporting] = useState(false);

  // --- H√ÄM ƒê·ªäNH D·∫†NG NG√ÄY (dd/mm/yyyy) ---
  const formatDate = (dateString) => {
    if (!dateString) return '';
    const [year, month, day] = dateString.split('-');
    return `${day}/${month}/${year}`;
  };

  // --- M√ÄU S·∫ÆC & INPUT ---
  const getStatusColor = (value) => {
    switch (value) {
      case 'B√≥ / Ng·∫Øn': return 'text-red-600 font-bold bg-red-50';
      case 'L·ªèng / D√†i': return 'text-blue-600 font-bold bg-blue-50';
      case 'ƒê·ªï Tr∆∞·ªõc': return 'text-orange-600 font-bold bg-orange-50';
      case 'ƒê·ªï Sau': return 'text-indigo-600 font-bold bg-indigo-50';
      case 'Nghi√™ng Tr√°i': return 'text-green-600 font-bold bg-green-50';
      case 'Nghi√™ng Ph·∫£i': return 'text-rose-600 font-bold bg-rose-50';
      case 'Ph·∫£i xoay sau - Tr√°i xoay tr∆∞·ªõc': return 'text-fuchsia-600 font-bold bg-fuchsia-50';
      case 'Tr√°i xoay sau - Ph·∫£i xoay tr∆∞·ªõc': return 'text-cyan-600 font-bold bg-cyan-50';
      case 'Ch∆∞a x√°c ƒë·ªãnh': 
      default: return 'text-gray-400 font-normal';
    }
  };

  const muscleStatusOptions = ['Ch∆∞a x√°c ƒë·ªãnh', 'B√≥ / Ng·∫Øn', 'L·ªèng / D√†i'];
  const pelvisSideOptions = ['Ch∆∞a x√°c ƒë·ªãnh', 'ƒê·ªï Tr∆∞·ªõc', 'ƒê·ªï Sau'];
  const pelvisTiltOptions = ['Ch∆∞a x√°c ƒë·ªãnh', 'Nghi√™ng Tr√°i', 'Nghi√™ng Ph·∫£i'];
  const pelvisRotationOptions = ['Ch∆∞a x√°c ƒë·ªãnh', 'Ph·∫£i xoay sau - Tr√°i xoay tr∆∞·ªõc', 'Tr√°i xoay sau - Ph·∫£i xoay tr∆∞·ªõc'];

  const handlePelvisChange = (field, value) => setFormData(prev => ({ ...prev, pelvis: { ...prev.pelvis, [field]: value } }));
  const handleMuscleChange = (muscleKey, side, value) => setFormData(prev => ({ ...prev, muscles: { ...prev.muscles, [muscleKey]: { ...prev.muscles[muscleKey], [side]: value } } }));

  // --- XU·∫§T ·∫¢NH T·ªêI ∆ØU ---
  const handleExportImage = async () => {
    if (!window.html2canvas) { alert("ƒêang t·∫£i th∆∞ vi·ªán ·∫£nh, vui l√≤ng th·ª≠ l·∫°i sau 2 gi√¢y!"); return; }
    setIsExporting(true);
    try {
      const element = document.getElementById('report-print-area');
      
      // C·∫•u h√¨nh t·ªëi ∆∞u cho Mobile
      const canvas = await window.html2canvas(element, { 
          scale: 3, // TƒÉng ƒë·ªô ph√¢n gi·∫£i
          useCORS: true, 
          backgroundColor: '#ffffff',
          windowWidth: 600, // ƒê·∫∑t chi·ªÅu r·ªông gi·∫£ l·∫≠p
          onclone: (clonedDoc) => {
              const clonedElement = clonedDoc.getElementById('report-print-area');
              if(clonedElement) {
                  clonedElement.style.width = '700px'; 
                  clonedElement.style.padding = '30px';
              }
          }
      });
      
      const image = canvas.toDataURL("image/png");
      const link = document.createElement('a');
      link.href = image;
      link.download = `KetQua_${formData.studentName || 'HocVien'}.png`;
      link.click();
    } catch (err) {
      alert("L·ªói khi xu·∫•t ·∫£nh: " + err);
    }
    setIsExporting(false);
  };

  const generateTextReport = () => {
    let text = `üìã B·∫¢NG K·∫æT QU·∫¢ TEST CH·∫¨U\nüë§ H·ªçc vi√™n: ${formData.studentName}\nüìÖ Ng√†y: ${formatDate(formData.testDate)}\n---\n`;
    text += `1. CH·∫¨U:\n Tr√°i: ${formData.pelvis.left}\n Ph·∫£i: ${formData.pelvis.right}\n Nghi√™ng: ${formData.pelvis.tilt}\n Xoay: ${formData.pelvis.rotation}\n\n`;
    text += `2. C∆† (V·∫•n ƒë·ªÅ):\n`;
    Object.values(formData.muscles).forEach(m => {
        if(m.left !== 'Ch∆∞a x√°c ƒë·ªãnh' || m.right !== 'Ch∆∞a x√°c ƒë·ªãnh') text += `- ${m.name}: Tr√°i(${m.left}) | Ph·∫£i(${m.right})\n`;
    });
    return text;
  };
  
  const copyToClipboard = () => {
    navigator.clipboard.writeText(generateTextReport());
    alert('ƒê√£ sao ch√©p n·ªôi dung vƒÉn b·∫£n!');
  };

  const resetForm = () => {
    if(confirm('X√≥a h·∫øt d·ªØ li·ªáu ƒë·ªÉ nh·∫≠p m·ªõi?')) {
      setFormData(initialData);
      setShowReport(false);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 p-2 sm:p-4 font-sans text-slate-800">
      <div className="max-w-5xl mx-auto bg-white shadow-xl rounded-none sm:rounded-xl overflow-hidden">
        
        {/* HEADER */}
        <div className="bg-teal-700 p-3 sm:p-4 text-white flex justify-between items-center sticky top-0 z-20 shadow-md">
          <div className="flex items-center gap-3">
            <div className="flex flex-col select-none">
              <h1 className="text-lg sm:text-2xl font-bold uppercase leading-tight tracking-wide">C√î TH∆Ø B√åNH AN</h1>
              <span className="text-[10px] sm:text-sm text-teal-100 uppercase tracking-widest font-medium opacity-90">B√¨nh T√¢m - Tr√≠ Tu·ªá - Y√™u Th∆∞∆°ng</span>
            </div>
          </div>
          
          <button onClick={resetForm} className="bg-teal-800 p-2 rounded-lg hover:bg-teal-900 transition-colors shadow-sm" title="Nh·∫≠p m·ªõi"><RotateCcw size={18} /></button>
        </div>

        <div className="p-2 sm:p-6 space-y-4 sm:space-y-6">
          {/* Ti√™u ƒë·ªÅ ch√≠nh */}
          <h2 className="text-base sm:text-xl font-bold text-teal-800 text-center uppercase border-b-2 border-teal-100 pb-2 mt-2">
            B·∫£ng Ki·ªÉm Tra Ch·∫≠u
          </h2>

          {/* Form Nh·∫≠p Li·ªáu */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 bg-gray-50 p-3 rounded border border-gray-200">
             <div><label className="text-xs font-bold text-gray-500 uppercase">T√™n H·ªçc Vi√™n</label><input type="text" value={formData.studentName} onChange={(e) => setFormData({...formData, studentName: e.target.value})} className="w-full p-2 border rounded text-sm" placeholder="Nh·∫≠p t√™n..." /></div>
             <div><label className="text-xs font-bold text-gray-500 uppercase">Ng√†y Test</label><input type="date" value={formData.testDate} onChange={(e) => setFormData({...formData, testDate: e.target.value})} className="w-full p-2 border rounded text-sm" /></div>
          </div>

          {/* B·∫£ng Ch·∫≠u Input */}
          <div className="overflow-x-auto border border-gray-300 rounded shadow-sm">
              <h2 className="p-2 bg-gray-100 font-bold text-teal-800 uppercase text-xs border-b">1. Tr·∫°ng Th√°i Ch·∫≠u</h2>
              <table className="w-full text-xs sm:text-sm text-left border-collapse min-w-[350px]">
                <tbody>
                  <tr className="border-b border-gray-200">
                      <td rowSpan={2} className="p-1 bg-blue-50 font-bold text-center border-r w-12 sm:w-16 text-teal-900 align-middle" style={{verticalAlign: 'middle'}}>ƒê·ªî</td>
                      <td className="p-1 w-20 sm:w-32 font-semibold border-r align-middle" style={{verticalAlign: 'middle'}}>Ch·∫≠u Tr√°i</td>
                      <td className="p-1 align-middle" style={{verticalAlign: 'middle'}}>
                          <select value={formData.pelvis.left} onChange={(e) => handlePelvisChange('left', e.target.value)} className={`w-full p-1 sm:p-2 outline-none bg-transparent rounded ${getStatusColor(formData.pelvis.left)}`}>
                              {pelvisSideOptions.map(o=><option key={o} value={o} className="text-black bg-white font-normal">{o}</option>)}
                          </select>
                      </td>
                  </tr>
                  <tr className="border-b border-gray-200">
                      <td className="p-1 font-semibold border-r align-middle" style={{verticalAlign: 'middle'}}>Ch·∫≠u Ph·∫£i</td>
                      <td className="p-1 align-middle" style={{verticalAlign: 'middle'}}>
                          <select value={formData.pelvis.right} onChange={(e) => handlePelvisChange('right', e.target.value)} className={`w-full p-1 sm:p-2 outline-none bg-transparent rounded ${getStatusColor(formData.pelvis.right)}`}>
                              {pelvisSideOptions.map(o=><option key={o} value={o} className="text-black bg-white font-normal">{o}</option>)}
                          </select>
                      </td>
                  </tr>
                  <tr className="border-b border-gray-200">
                      <td colSpan={2} className="p-1 bg-purple-50 font-bold text-center border-r align-middle text-teal-900" style={{verticalAlign: 'middle'}}>NGHI√äNG</td>
                      <td className="p-1 align-middle" style={{verticalAlign: 'middle'}}>
                          <select value={formData.pelvis.tilt} onChange={(e) => handlePelvisChange('tilt', e.target.value)} className={`w-full p-1 sm:p-2 outline-none bg-transparent rounded ${getStatusColor(formData.pelvis.tilt)}`}>
                              {pelvisTiltOptions.map(o=><option key={o} value={o} className="text-black bg-white font-normal">{o}</option>)}
                          </select>
                      </td>
                  </tr>
                  <tr>
                      <td colSpan={2} className="p-1 bg-purple-50 font-bold text-center border-r align-middle text-teal-900" style={{verticalAlign: 'middle'}}>XOAY</td>
                      <td className="p-1 align-middle" style={{verticalAlign: 'middle'}}>
                          <select value={formData.pelvis.rotation} onChange={(e) => handlePelvisChange('rotation', e.target.value)} className={`w-full p-1 sm:p-2 outline-none bg-transparent rounded ${getStatusColor(formData.pelvis.rotation)}`}>
                              {pelvisRotationOptions.map(o=><option key={o} value={o} className="text-black bg-white font-normal">{o}</option>)}
                          </select>
                      </td>
                  </tr>
                </tbody>
              </table>
          </div>

          {/* B·∫£ng C∆° Input */}
          <div className="overflow-x-auto rounded border border-gray-300 shadow-sm">
             <h2 className="p-2 bg-gray-100 font-bold text-teal-800 uppercase text-xs border-b">2. Tr·∫°ng Th√°i C∆°</h2>
              <table className="w-full text-xs sm:text-sm border-collapse min-w-[350px]">
                <thead className="bg-teal-700 text-white">
                    <tr>
                        <th className="p-2 border border-teal-600 w-8 text-center align-middle" style={{verticalAlign: 'middle'}}>#</th>
                        <th className="p-2 border border-teal-600 text-left align-middle" style={{verticalAlign: 'middle'}}>T√™n C∆°</th>
                        <th className="p-2 border border-teal-600 w-20 sm:w-28 text-center align-middle" style={{verticalAlign: 'middle'}}>Tr√°i</th>
                        <th className="p-2 border border-teal-600 w-20 sm:w-28 text-center align-middle" style={{verticalAlign: 'middle'}}>Ph·∫£i</th>
                    </tr>
                </thead>
                <tbody className="bg-white">
                  {Object.entries(formData.muscles).map(([key, m], idx) => (
                    <tr key={key} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                      <td className="p-1 border text-center text-gray-500 align-middle" style={{verticalAlign: 'middle'}}>{m.id}</td>
                      <td className="p-1 border font-medium align-middle" style={{verticalAlign: 'middle'}}>{m.name}</td>
                      <td className="p-0.5 border align-middle" style={{verticalAlign: 'middle'}}>
                          <select value={m.left} onChange={(e) => handleMuscleChange(key, 'left', e.target.value)} className={`w-full p-1 sm:p-2 text-center outline-none bg-transparent rounded text-[11px] sm:text-sm ${getStatusColor(m.left)}`}>
                              {muscleStatusOptions.map(o=><option key={o} value={o} className="text-black bg-white font-normal">{o}</option>)}
                          </select>
                      </td>
                      <td className="p-0.5 border align-middle" style={{verticalAlign: 'middle'}}>
                          <select value={m.right} onChange={(e) => handleMuscleChange(key, 'right', e.target.value)} className={`w-full p-1 sm:p-2 text-center outline-none bg-transparent rounded text-[11px] sm:text-sm ${getStatusColor(m.right)}`}>
                              {muscleStatusOptions.map(o=><option key={o} value={o} className="text-black bg-white font-normal">{o}</option>)}
                          </select>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
          </div>
            
          {/* Ghi ch√∫ */}
          <div><label className="text-xs font-bold text-gray-500 uppercase mb-1 block">Ghi ch√∫</label><textarea value={formData.note} onChange={(e) => setFormData({...formData, note: e.target.value})} className="w-full p-3 border border-gray-300 rounded h-20 outline-none focus:border-teal-500 text-sm" placeholder="..." /></div>

          {/* Footer Buttons */}
          <div className="flex flex-col gap-3 pb-10">
              <button onClick={() => setShowReport(true)} className="w-full bg-teal-700 hover:bg-teal-800 text-white font-bold py-3 sm:py-4 rounded shadow-lg flex items-center justify-center gap-2 uppercase tracking-wide text-sm sm:text-base">
                <Save size={18} /> XU·∫§T K·∫æT QU·∫¢
              </button>
          </div>
        </div>
      </div>

      {/* Modal Report - K·∫æT QU·∫¢ */}
      {showReport && (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-2 sm:p-4 z-50 animate-in fade-in duration-200">
          <div className="bg-white rounded-lg shadow-2xl max-w-4xl w-full flex flex-col max-h-[95vh]">
            <div className="p-3 sm:p-4 border-b bg-teal-700 text-white flex justify-between items-center rounded-t-lg">
              <h3 className="font-bold text-base sm:text-lg flex items-center gap-2"><CheckCircle size={20} /> B·∫¢NG K·∫æT QU·∫¢</h3>
              <button onClick={() => setShowReport(false)} className="text-white/80 hover:text-white rounded p-1"><X size={24} /></button>
            </div>
            
            <div className="p-2 sm:p-4 overflow-y-auto bg-slate-100 font-sans">
              
              {/* === KHU V·ª∞C IN ·∫¢NH === */}
              <div id="report-print-area" className="bg-white p-4 sm:p-8 shadow-sm rounded-lg mx-auto w-full" style={{minWidth: '600px'}}>
                 
                 {/* HEADER REPORT */}
                 <div className="border-b-2 border-teal-600 pb-3 mb-4 text-center">
                    <h1 className="text-2xl font-bold text-teal-900 uppercase">B·∫¢NG K·∫æT QU·∫¢ TEST CH·∫¨U</h1>
                 </div>

                 {/* Th√¥ng tin h·ªçc vi√™n */}
                 <div className="bg-teal-50 p-4 rounded mb-4 border border-teal-100 flex justify-between items-center">
                    <div>
                        <span className="text-teal-800 font-bold uppercase text-sm mr-2">H·ªçc vi√™n:</span>
                        <strong className="text-lg text-teal-900">{formData.studentName || '....................'}</strong>
                    </div>
                    <div>
                        <span className="text-teal-800 font-bold uppercase text-sm mr-2">Ng√†y:</span>
                        <span className="text-base text-teal-900 font-semibold">{formatDate(formData.testDate)}</span>
                    </div>
                 </div>

                 {/* Report Ch·∫≠u */}
                 <div className="mb-6">
                    <h5 className="font-bold text-teal-800 mb-2 uppercase text-sm border-l-4 border-teal-600 pl-2">I. Tr·∫°ng Th√°i Ch·∫≠u</h5>
                    <div className="overflow-hidden border border-gray-400 rounded">
                        <table className="w-full text-sm border-collapse">
                        <tbody>
                            <tr>
                                <td rowSpan={2} className="border border-gray-400 p-2 bg-blue-100 font-bold text-center w-24 align-middle text-teal-900" style={{verticalAlign: 'middle'}}>ƒê·ªî</td>
                                <td className="border border-gray-400 p-2 w-32 font-semibold align-middle" style={{verticalAlign: 'middle'}}>Ch·∫≠u Tr√°i</td>
                                <td className={`border border-gray-400 p-2 font-bold text-center align-middle ${getStatusColor(formData.pelvis.left)}`} style={{verticalAlign: 'middle'}}>{formData.pelvis.left}</td>
                            </tr>
                            <tr>
                                <td className="border border-gray-400 p-2 font-semibold align-middle" style={{verticalAlign: 'middle'}}>Ch·∫≠u Ph·∫£i</td>
                                <td className={`border border-gray-400 p-2 font-bold text-center align-middle ${getStatusColor(formData.pelvis.right)}`} style={{verticalAlign: 'middle'}}>{formData.pelvis.right}</td>
                            </tr>
                            <tr>
                                <td colSpan={2} className="border border-gray-400 p-2 bg-purple-100 font-bold text-center align-middle text-teal-900" style={{verticalAlign: 'middle'}}>NGHI√äNG</td>
                                <td className={`border border-gray-400 p-2 font-bold text-center align-middle ${getStatusColor(formData.pelvis.tilt)}`} style={{verticalAlign: 'middle'}}>{formData.pelvis.tilt}</td>
                            </tr>
                            <tr>
                                <td colSpan={2} className="border border-gray-400 p-2 bg-purple-100 font-bold text-center align-middle text-teal-900" style={{verticalAlign: 'middle'}}>XOAY</td>
                                <td className={`border border-gray-400 p-2 font-bold text-center align-middle ${getStatusColor(formData.pelvis.rotation)}`} style={{verticalAlign: 'middle'}}>{formData.pelvis.rotation}</td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                 </div>

                 {/* Report C∆° */}
                 <div className="mb-4">
                    <h5 className="font-bold text-teal-800 mb-2 uppercase text-sm border-l-4 border-teal-600 pl-2">II. Tr·∫°ng Th√°i C∆°</h5>
                    <div className="overflow-hidden border border-gray-400 rounded">
                        <table className="w-full text-sm border-collapse">
                        <thead className="bg-teal-700 text-white print:bg-teal-700">
                            <tr>
                                <th className="border border-gray-400 p-2 w-10 text-center align-middle" style={{verticalAlign: 'middle'}}>#</th>
                                <th className="border border-gray-400 p-2 text-left align-middle" style={{verticalAlign: 'middle'}}>T√™n C∆°</th>
                                <th className="border border-gray-400 p-2 w-28 text-center align-middle" style={{verticalAlign: 'middle'}}>Tr√°i</th>
                                <th className="border border-gray-400 p-2 w-28 text-center align-middle" style={{verticalAlign: 'middle'}}>Ph·∫£i</th>
                            </tr>
                        </thead>
                        <tbody>
                            {Object.values(formData.muscles).map((m, idx) => (
                                <tr key={idx}>
                                    <td className="border border-gray-400 p-2 text-center text-gray-500 align-middle" style={{verticalAlign: 'middle'}}>{m.id}</td>
                                    <td className="border border-gray-400 p-2 font-medium align-middle" style={{verticalAlign: 'middle'}}>{m.name}</td>
                                    <td className={`border border-gray-400 p-2 text-center font-bold align-middle ${getStatusColor(m.left)}`} style={{verticalAlign: 'middle'}}>{m.left}</td>
                                    <td className={`border border-gray-400 p-2 text-center font-bold align-middle ${getStatusColor(m.right)}`} style={{verticalAlign: 'middle'}}>{m.right}</td>
                                </tr>
                            ))}
                        </tbody>
                        </table>
                    </div>
                 </div>

                 {formData.note && (
                    <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded text-sm text-gray-800 italic"><strong className="not-italic text-yellow-700">Ghi ch√∫:</strong> {formData.note}</div>
                 )}
                 
                 {/* Footer */}
                 <div className="mt-8 text-center border-t border-gray-200 pt-4 pb-2">
                    <p className="font-serif italic text-teal-700 text-base font-medium tracking-wide">
                       ~ B√¨nh T√¢m - Tr√≠ Tu·ªá - Y√™u Th∆∞∆°ng ~
                    </p>
                 </div>
              </div>
            </div>

            {/* Footer Buttons */}
            <div className="p-3 sm:p-4 border-t bg-white flex flex-col sm:flex-row gap-2">
              <button onClick={handleExportImage} disabled={isExporting} className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded flex items-center justify-center gap-2 shadow text-sm sm:text-base">
                {isExporting ? 'ƒêang x·ª≠ l√Ω...' : <><ImageIcon size={18} /> T·∫£i ·∫¢nh</>}
              </button>
              <button onClick={copyToClipboard} className="flex-none sm:w-auto px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 rounded border border-gray-300 flex items-center justify-center" title="Copy Text"><Clipboard size={18} /></button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default PelvicTestApp;
